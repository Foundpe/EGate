<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minhook // Administration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: {
              900: '#050505',
              800: '#0a0a0a',
              700: '#111111',
            },
            brand: {
              red: '#dc2626',
              glow: 'rgba(220, 38, 38, 0.5)'
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          }
        }
      }
    }
  </script>

  <style>
    /* Base Styles */
    body {
      background-color: #000000;
      background-image: radial-gradient(circle at 50% 0%, #1a0505 0%, #000000 70%);
      color: #e5e7eb;
      overflow: hidden; /* Hide scrollbars usually */
    }

    /* Scrollbar Customization */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #dc2626; }

    /* Glass Effect & Containers */
    .glass-panel {
      background: rgba(10, 10, 10, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
    }
    
    .glow-border:focus-within {
      border-color: #dc2626;
      box-shadow: 0 0 15px rgba(220, 38, 38, 0.2);
    }

    /* Inputs & Buttons */
    .input-field {
      background: #050505;
      border: 1px solid #222;
      color: #fff;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      transition: all 0.3s ease;
    }
    .input-field:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 10px rgba(220, 38, 38, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #991b1b 0%, #dc2626 100%);
      color: white;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid #ef4444;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.75rem;
      font-weight: 700;
    }
    .btn-primary:hover {
      box-shadow: 0 0 20px rgba(220, 38, 38, 0.4);
      transform: translateY(-1px);
    }
    .btn-primary:active { transform: translateY(0); }

    /* Animations */
    @keyframes pulse-red {
      0%, 100% { box-shadow: 0 0 5px rgba(220, 38, 38, 0.1); }
      50% { box-shadow: 0 0 20px rgba(220, 38, 38, 0.3); }
    }
    .animate-pulse-red { animation: pulse-red 3s infinite; }

    /* Anti-Select */
    .noselect {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
</head>
<body class="flex h-screen text-sm antialiased noselect">

<div id="auth-layer" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-95 backdrop-blur-md">
  <div class="glass-panel p-8 rounded-xl w-full max-w-sm text-center border-t-2 border-brand-red relative overflow-hidden">
    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-600 to-transparent"></div>
    
    <div class="mb-6">
      <i class="fa-solid fa-shield-cat text-4xl text-red-600 mb-2 animate-pulse-red"></i>
      <h1 class="text-2xl font-bold tracking-widest text-white mt-2">MINHOOK</h1>
      <p class="text-xs text-gray-500 uppercase tracking-widest">Secure Environment</p>
    </div>

    <div class="space-y-4">
      <div class="relative">
        <i class="fa-solid fa-lock absolute left-3 top-3 text-gray-500"></i>
        <input id="adminPass" type="password" class="input-field w-full p-2.5 pl-10 rounded-md" placeholder="Enter Access Code">
      </div>
      <button onclick="attemptLogin()" class="btn-primary w-full py-3 rounded-md">
        Initialize Session
      </button>
    </div>
    <p id="loginMsg" class="mt-4 text-xs font-mono h-4 text-red-500"></p>
  </div>
</div>

<aside class="w-64 glass-panel border-r border-gray-900 flex flex-col z-10 transition-all duration-300">
  <div class="p-6 flex items-center gap-3 border-b border-gray-800">
    <div class="w-8 h-8 rounded bg-red-900 flex items-center justify-center text-red-200">
      <i class="fa-solid fa-dragon"></i>
    </div>
    <div>
      <h2 class="font-bold text-gray-100">MINHOOK</h2>
      <span class="text-[10px] text-green-500 flex items-center gap-1">
        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> SYSTEM ONLINE
      </span>
    </div>
  </div>

  <nav class="flex-1 p-4 space-y-2">
    <button onclick="switchTab('generate')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-all group active-tab">
      <i class="fa-solid fa-key group-hover:text-red-500 transition-colors"></i>
      <span>Generator</span>
    </button>
    <button onclick="switchTab('users')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-all group">
      <i class="fa-solid fa-users group-hover:text-red-500 transition-colors"></i>
      <span>User Database</span>
    </button>
    <button onclick="switchTab('tools')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-white/5 transition-all group">
      <i class="fa-solid fa-screwdriver-wrench group-hover:text-red-500 transition-colors"></i>
      <span>Utilities</span>
    </button>
  </nav>

  <div class="p-4 border-t border-gray-800">
    <button onclick="location.reload()" class="w-full flex items-center gap-2 text-xs text-gray-500 hover:text-red-500 transition-colors">
      <i class="fa-solid fa-power-off"></i> Terminate Session
    </button>
  </div>
</aside>

<main class="flex-1 p-6 overflow-y-auto relative">
  <div class="absolute top-0 right-0 w-96 h-96 bg-red-900/10 rounded-full blur-3xl pointer-events-none"></div>

  <div id="tab-generate" class="content-tab space-y-6 max-w-4xl mx-auto animate-fade-in">
    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
      <i class="fa-solid fa-microchip text-red-500"></i> License Factory
    </h2>

    <div class="glass-panel p-1 rounded-lg inline-flex mb-4 bg-black/50">
        <button onclick="toggleGenMode('single')" id="btn-mode-single" class="px-4 py-1.5 rounded text-xs font-bold transition-all bg-red-600 text-white">SINGLE</button>
        <button onclick="toggleGenMode('bulk')" id="btn-mode-bulk" class="px-4 py-1.5 rounded text-xs font-bold text-gray-400 transition-all hover:text-white">BULK MODE</button>
    </div>

    <div class="glass-panel p-6 rounded-xl border-l-4 border-red-600">
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
           <label class="text-xs text-gray-500 uppercase font-bold block mb-2">License Type</label>
           <select id="gen_type" class="input-field w-full p-2.5 rounded">
             <option value="paid">Standard (HWID Locked)</option>
             <option value="free">Free (No HWID)</option>
           </select>
        </div>
        <div>
          <label class="text-xs text-gray-500 uppercase font-bold block mb-2">Duration (Days)</label>
          <input id="gen_days" type="number" value="30" class="input-field w-full p-2.5 rounded text-center">
        </div>
        <div id="qty_container" class="hidden">
            <label class="text-xs text-gray-500 uppercase font-bold block mb-2">Quantity</label>
            <input id="gen_qty" type="number" value="5" max="50" class="input-field w-full p-2.5 rounded text-center border-red-900 text-red-100">
          </div>
      </div>

      <button onclick="processGeneration()" class="btn-primary w-full py-3 rounded flex items-center justify-center gap-2 group">
        <span>Execute Generation</span>
        <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
      </button>

      <div id="output-console" class="mt-6 hidden">
        <div class="flex justify-between items-center mb-2">
             <span class="text-xs text-gray-400 font-mono">Console Output_</span>
             <button onclick="copyConsole()" class="text-xs text-red-400 hover:text-red-300"><i class="fa-regular fa-copy"></i> Copy All</button>
        </div>
        <textarea id="console_text" readonly class="w-full h-48 bg-black border border-gray-800 rounded p-3 font-mono text-xs text-green-400 leading-relaxed resize-none focus:outline-none"></textarea>
      </div>

    </div>
  </div>

  <div id="tab-users" class="content-tab hidden space-y-4 max-w-6xl mx-auto">
    <div class="flex justify-between items-end mb-4">
      <div>
        <h2 class="text-2xl font-bold flex items-center gap-2">
            <i class="fa-solid fa-database text-red-500"></i> Live Database
        </h2>
        <p class="text-xs text-gray-500 mt-1">Updates automatically every 3 seconds</p>
      </div>
      <div class="flex gap-2">
          <div class="flex items-center gap-2 px-3 py-1 bg-black/40 rounded border border-gray-800">
              <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
              <span class="text-xs text-gray-400">Auto-Sync</span>
              <input type="checkbox" id="autoSyncToggle" checked class="accent-red-600">
          </div>
          <button onclick="forceLoadUsers()" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded text-xs"><i class="fa-solid fa-rotate"></i></button>
      </div>
    </div>

    <div class="flex gap-2 mb-4">
        <input id="searchUsers" type="text" placeholder="Search key, email or HWID..." class="input-field flex-1 p-2 rounded bg-black/50">
        <select id="filterState" class="input-field w-32 p-2 rounded bg-black/50">
            <option value="all">All Status</option>
            <option value="active">Active</option>
            <option value="expired">Expired</option>
        </select>
    </div>

    <div id="user-grid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 pb-10">
        </div>
  </div>

  <div id="tab-tools" class="content-tab hidden space-y-6 max-w-4xl mx-auto">
    <h2 class="text-2xl font-bold flex items-center gap-2 mb-6">
        <i class="fa-solid fa-toolbox text-red-500"></i> System Utilities
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="glass-panel p-5 rounded-lg">
            <h3 class="font-bold text-gray-300 mb-3"><i class="fa-solid fa-magnifying-glass"></i> Inspect Key</h3>
            <input id="tool_verify_key" placeholder="Key string..." class="input-field w-full p-2 mb-2 rounded">
            <button onclick="toolCheck()" class="w-full py-2 bg-gray-800 hover:bg-gray-700 rounded text-xs border border-gray-700 text-white">Verify Status</button>
            <pre id="verify_result" class="mt-2 text-[10px] text-gray-400 font-mono"></pre>
        </div>

        <div class="glass-panel p-5 rounded-lg border border-red-900/30">
            <h3 class="font-bold text-red-400 mb-3"><i class="fa-solid fa-skull"></i> Reset HWID</h3>
            <input id="tool_reset_key" placeholder="Key string..." class="input-field w-full p-2 mb-2 rounded">
            <button onclick="toolReset()" class="w-full py-2 bg-red-900/50 hover:bg-red-900 rounded text-xs border border-red-800 text-white">Force Reset</button>
            <p id="reset_msg" class="mt-2 text-xs text-gray-400"></p>
        </div>

        <div class="glass-panel p-5 rounded-lg md:col-span-2 border-t border-red-600">
            <h3 class="font-bold text-white mb-3">Danger Zone</h3>
            <div class="flex gap-4">
                <button onclick="downloadBackup()" class="flex-1 py-3 bg-gray-900 hover:bg-gray-800 border border-gray-700 rounded text-xs">
                    <i class="fa-solid fa-download mb-1 block text-lg"></i> Backup Database
                </button>
                <button onclick="nukeDatabase()" class="flex-1 py-3 bg-red-950 hover:bg-red-900 border border-red-700 text-red-200 rounded text-xs">
                    <i class="fa-solid fa-bomb mb-1 block text-lg"></i> Delete ALL Keys
                </button>
            </div>
        </div>
    </div>
  </div>

</main>

<div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>

<script>
    /* --- CONFIG --- */
    const API = "https://egatesystem.vercel.app/api"; // Tu API
    let ADMIN = "";
    let GEN_MODE = "single"; // 'single' | 'bulk'
    let AUTO_REFRESH_INTERVAL = null;
    let IS_DRAGGING = false;

    /* --- SECURITY & UI --- */
    // Anti-DevTools Basic
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.onkeydown = function(e) {
        if(e.keyCode == 123) return false;
        if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
        if(e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) return false;
        if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
        if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
    }

    function switchTab(tabId) {
        document.querySelectorAll('.content-tab').forEach(el => el.classList.add('hidden'));
        document.getElementById(`tab-${tabId}`).classList.remove('hidden');
        
        // Update Sidebar visual
        document.querySelectorAll('nav button').forEach(btn => {
            btn.classList.remove('bg-white/5', 'text-white');
            btn.classList.add('text-gray-400');
        });
        const activeBtn = document.querySelector(`button[onclick="switchTab('${tabId}')"]`);
        if(activeBtn) {
            activeBtn.classList.add('bg-white/5', 'text-white');
            activeBtn.classList.remove('text-gray-400');
        }

        // Handle auto-refresh logic
        if (tabId === 'users') {
            startAutoRefresh();
        } else {
            stopAutoRefresh();
        }
    }

    function toggleGenMode(mode) {
        GEN_MODE = mode;
        const btnSingle = document.getElementById('btn-mode-single');
        const btnBulk = document.getElementById('btn-mode-bulk');
        const qtyContainer = document.getElementById('qty_container');

        if(mode === 'bulk') {
            btnSingle.classList.replace('bg-red-600', 'text-gray-400');
            btnSingle.classList.remove('text-white');
            btnBulk.classList.add('bg-red-600', 'text-white');
            btnBulk.classList.remove('text-gray-400');
            qtyContainer.classList.remove('hidden');
        } else {
            btnBulk.classList.replace('bg-red-600', 'text-gray-400');
            btnBulk.classList.remove('text-white');
            btnSingle.classList.add('bg-red-600', 'text-white');
            btnSingle.classList.remove('text-gray-400');
            qtyContainer.classList.add('hidden');
        }
    }

    function showToast(msg, type = 'info') {
        const container = document.getElementById('toast-container');
        const el = document.createElement('div');
        const colorClass = type === 'error' ? 'border-red-500 bg-black' : 'border-green-500 bg-black';
        const icon = type === 'error' ? '<i class="fa-solid fa-circle-xmark text-red-500"></i>' : '<i class="fa-solid fa-circle-check text-green-500"></i>';
        
        el.className = `p-3 rounded border-l-4 ${colorClass} text-white shadow-lg text-xs flex items-center gap-3 min-w-[200px] animate-bounce-in pointer-events-auto`;
        el.innerHTML = `${icon} <span>${msg}</span>`;
        
        container.appendChild(el);
        setTimeout(() => el.remove(), 3000);
    }

    /* --- AUTH --- */
    async function attemptLogin() {
        const pass = document.getElementById('adminPass').value;
        const msg = document.getElementById('loginMsg');
        
        if(!pass) return;
        msg.textContent = "Negotiating...";

        try {
            // Check against API (dummy call)
            const res = await fetch(`${API}/info?key=dummy&admin=${encodeURIComponent(pass)}`);
            if (res.status === 403) throw new Error("Access Denied");

            ADMIN = pass;
            document.getElementById('auth-layer').classList.add('hidden');
            showToast("System Access Granted", "success");
            switchTab('generate'); // Default tab
        } catch (e) {
            msg.textContent = "Invalid Credentials";
            document.getElementById('adminPass').classList.add('border-red-600');
            setTimeout(() => document.getElementById('adminPass').classList.remove('border-red-600'), 1000);
        }
    }

    /* --- GENERATOR LOGIC --- */
    async function processGeneration() {
        const type = document.getElementById('gen_type').value;
        const days = document.getElementById('gen_days').value || "30";
        const qty = GEN_MODE === 'bulk' ? parseInt(document.getElementById('gen_qty').value) : 1;
        
        const consoleDiv = document.getElementById('output-console');
        const consoleText = document.getElementById('console_text');
        
        consoleDiv.classList.remove('hidden');
        consoleText.value = ">>> INITIALIZING GENERATION SEQUENCE...\n";
        
        const isFree = type === 'free';
        const keysGenerated = [];

        // Loop for Bulk
        for (let i = 0; i < qty; i++) {
            try {
                const url = `${API}/make?admin=${ADMIN}&days=${days}${isFree ? '&nohwid=true' : ''}`;
                const res = await fetch(url);
                const raw = await res.text();
                
                if (!res.ok) throw new Error(raw);

                // Clean Key
                let cleanKey = raw;
                if (raw.includes("(")) cleanKey = raw.split("(")[0].trim();
                
                // Format for user
                const label = GEN_MODE === 'bulk' ? `Key${i}` : `Key`;
                const line = `${label} :: ${cleanKey}`;
                
                keysGenerated.push(line);
                consoleText.value += `[SUCCESS] ${line}\n`;
                consoleText.scrollTop = consoleText.scrollHeight; // Auto scroll

            } catch (err) {
                consoleText.value += `[ERROR] Failed to gen key ${i}: ${err.message}\n`;
            }
        }

        consoleText.value += `>>> PROCESS COMPLETE. Generated ${keysGenerated.length} keys.`;
        showToast(`Generated ${keysGenerated.length} keys`, "success");
    }

    function copyConsole() {
        const txt = document.getElementById('console_text');
        txt.select();
        document.execCommand('copy');
        showToast("Console output copied to clipboard");
    }

    /* --- USER MANAGER --- */
    function startAutoRefresh() {
        if(AUTO_REFRESH_INTERVAL) clearInterval(AUTO_REFRESH_INTERVAL);
        loadUsers(); // Load immediately
        AUTO_REFRESH_INTERVAL = setInterval(() => {
            const toggle = document.getElementById('autoSyncToggle');
            // Only refresh if toggle is on AND user is not typing in search
            if (toggle.checked && document.activeElement.id !== 'searchUsers') {
                loadUsers(true); // true = silent mode
            }
        }, 3000);
    }

    function stopAutoRefresh() {
        if(AUTO_REFRESH_INTERVAL) clearInterval(AUTO_REFRESH_INTERVAL);
    }
    
    function forceLoadUsers() {
        loadUsers(false);
    }

    async function loadUsers(silent = false) {
        const grid = document.getElementById('user-grid');
        if(!silent) grid.style.opacity = "0.5";

        try {
            const res = await fetch(`${API}/dump?admin=${ADMIN}`);
            const text = await res.text();
            
            // Parse logic (handle text before JSON)
            const jsonStart = text.indexOf("{");
            if (jsonStart === -1) throw new Error("Invalid Data");
            const data = JSON.parse(text.slice(jsonStart));
            const allKeys = data.keys ? data.keys : data;

            renderUsers(allKeys);
        } catch (e) {
            console.error(e);
            if(!silent) showToast("Sync Error", "error");
        } finally {
            grid.style.opacity = "1";
        }
    }

    function renderUsers(keysObj) {
        const grid = document.getElementById('user-grid');
        const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
        const filterState = document.getElementById('filterState').value;

        let html = "";
        
        // Reverse order (newest first usually)
        Object.entries(keysObj).reverse().forEach(([key, info]) => {
            const isActive = info.expires && new Date(info.expires) > new Date();
            const statusStr = isActive ? "active" : "expired";

            // Filtering
            if (filterState !== 'all' && filterState !== statusStr) return;
            if (searchTerm && !key.toLowerCase().includes(searchTerm) && !(info.email||"").toLowerCase().includes(searchTerm)) return;

            // Template
            html += `
            <div class="glass-panel p-4 rounded-lg relative group hover:border-red-900 transition-colors">
                <div class="flex justify-between items-start mb-2">
                    <div class="font-mono text-xs text-red-400 break-all pr-6 font-bold select-all">${key}</div>
                    <span class="px-2 py-0.5 rounded text-[10px] uppercase font-bold ${isActive ? 'bg-green-900/40 text-green-400 border border-green-800' : 'bg-red-900/40 text-red-500 border border-red-800'}">
                        ${isActive ? 'Active' : 'Expired'}
                    </span>
                </div>
                
                <div class="space-y-1 text-[11px] text-gray-500 font-mono">
                    <div class="flex justify-between">
                        <span>HWID:</span>
                        <span class="text-gray-300 truncate max-w-[120px]" title="${info.hwid}">${info.hwid ? info.hwid : '—'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Email:</span>
                        <span class="text-gray-300 truncate max-w-[120px]">${info.email || '—'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Exp:</span>
                        <span class="${isActive ? 'text-gray-300' : 'text-red-900'}">${info.expires ? new Date(info.expires).toLocaleDateString() : '—'}</span>
                    </div>
                </div>

                <div class="absolute bottom-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onclick="quickDelete('${key}')" class="w-6 h-6 rounded bg-red-900 hover:bg-red-700 text-white flex items-center justify-center text-xs" title="Delete Key">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                     <button onclick="quickReset('${key}')" class="w-6 h-6 rounded bg-yellow-900 hover:bg-yellow-700 text-white flex items-center justify-center text-xs" title="Reset HWID">
                        <i class="fa-solid fa-sync"></i>
                    </button>
                </div>
            </div>
            `;
        });

        if (html === "") html = `<div class="col-span-full text-center text-gray-600 py-10 font-mono text-xs">NO DATA FOUND</div>`;
        
        // Simple DOM diffing could be better, but innerHTML is fine for small datasets
        grid.innerHTML = html;
    }

    async function quickDelete(key) {
        if(!confirm("Delete this key permanently?")) return;
        try {
            await fetch(`${API}/delete?key=${key}&admin=${ADMIN}`);
            showToast("Key Deleted", "success");
            loadUsers(true); // Immediate refresh
        } catch(e) { showToast("Error deleting", "error"); }
    }

    async function quickReset(key) {
        try {
            await fetch(`${API}/reset?key=${key}&admin=${ADMIN}`); // Asumiendo endpoint 'reset' para HWID
            showToast("HWID Reset", "success");
        } catch(e) { showToast("Error resetting", "error"); }
    }

    /* --- TOOLS LOGIC --- */
    async function toolCheck() {
        const k = document.getElementById('tool_verify_key').value;
        const resEl = document.getElementById('verify_result');
        resEl.innerText = "Querying...";
        try {
            const r = await fetch(`${API}/info?key=${k}&admin=${ADMIN}`);
            const d = await r.json();
            resEl.innerText = JSON.stringify(d, null, 2);
        } catch(e) { resEl.innerText = "Error / Not Found"; }
    }
    
    async function toolReset() {
        const k = document.getElementById('tool_reset_key').value;
        try {
            const r = await fetch(`${API}/adminReset?key=${k}&admin=${ADMIN}`);
            const t = await r.text();
            document.getElementById('reset_msg').innerText = t;
        } catch(e) { document.getElementById('reset_msg').innerText = "Fail"; }
    }

    async function nukeDatabase() {
        const code = prompt("Type 'DELETE-ALL' to confirm destruction of database.");
        if (code !== 'DELETE-ALL') return;
        
        try {
            await fetch(`${API}/deleteAll?admin=${ADMIN}`);
            showToast("DATABASE CLEARED", "error");
        } catch(e) { showToast("Command Failed", "error"); }
    }

    function downloadBackup() {
        window.open(`${API}/dump?admin=${ADMIN}`, '_blank');
    }

</script>
</body>
</html>
