<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EGate Key System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0f1117;
      color: #e5e7eb;
      font-family: 'Inter', sans-serif;
    }
    .tab-active {
      border-bottom: 3px solid #6366f1;
      color: #6366f1;
    }
  </style>
</head>
<body class="min-h-screen p-8">

  <div class="max-w-4xl mx-auto bg-[#1a1c23] rounded-2xl shadow-lg p-6">
    <h1 class="text-3xl font-bold text-center text-indigo-400 mb-6">EGate Key System</h1>

    <!-- Tabs -->
    <div class="flex justify-around border-b border-gray-700 mb-6">
      <button class="pb-3 tab-active" id="tab-verify" onclick="showTab('verify')">üîë Check Key</button>
      <button class="pb-3" id="tab-reset" onclick="showTab('reset')">‚ôªÔ∏è Reset HWID</button>
      <button class="pb-3" id="tab-email" onclick="showTab('email')">üìß Bind Email</button>
      <button class="pb-3" id="tab-admin" onclick="showTab('admin')">üõ†Ô∏è Admin</button>
    </div>

    <!-- Verify Panel -->
    <div id="verify" class="tab-panel">
      <h2 class="text-xl font-semibold mb-3">Check License Key</h2>
      <input id="v_key" class="input" placeholder="License Key">
      <input id="v_hwid" class="input" placeholder="HWID">
      <button class="btn mt-3" onclick="verifyKey()">Verify</button>
      <p id="verifyResult" class="mt-3 text-sm text-gray-400"></p>
    </div>

    <!-- Reset Panel -->
    <div id="reset" class="tab-panel hidden">
      <h2 class="text-xl font-semibold mb-3">Reset HWID</h2>
      <input id="r_key" class="input" placeholder="License Key">
      <button class="btn mt-3" onclick="resetKey()">Reset</button>
      <p id="resetResult" class="mt-3 text-sm text-gray-400"></p>
    </div>

    <!-- Email Panel -->
    <div id="email" class="tab-panel hidden">
      <h2 class="text-xl font-semibold mb-3">Bind Email</h2>
      <input id="bind_key" class="input" placeholder="License Key">
      <input id="bind_email" type="email" class="input" placeholder="Email Address">
      <button class="btn mt-3" onclick="bindEmailToKey()">Bind</button>
      <p id="bindEmailResult" class="mt-3 text-sm text-gray-400"></p>
    </div>

    <!-- Admin Panel -->
    <div id="admin" class="tab-panel hidden">
      <h2 class="text-xl font-semibold mb-4">Admin Panel</h2>
      
      <div id="admin-auth" class="bg-[#111318] p-4 rounded-xl">
        <input id="admin_password" type="password" class="input" placeholder="Admin Password">
        <button class="btn mt-3" onclick="authAdmin()">Login</button>
        <p id="adminLoginResult" class="mt-3 text-sm text-red-400"></p>
      </div>

      <div id="admin-actions" class="hidden mt-6 space-y-4">
        <div>
          <button class="btn bg-green-600 hover:bg-green-700" onclick="makeKey()">Generate Key</button>
          <p id="makeKeyResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
        <div>
          <input id="check_key" class="input" placeholder="Key to check">
          <button class="btn bg-indigo-600 hover:bg-indigo-700 mt-2" onclick="checkKeyInfo()">Check Info</button>
          <p id="checkKeyInfoResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
        <div>
          <button class="btn bg-red-600 hover:bg-red-700" onclick="deleteAllKeys()">Delete ALL Keys</button>
          <p id="deleteAllResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
        <div>
          <input id="delete_key" class="input" placeholder="Key to delete">
          <button class="btn bg-red-600 hover:bg-red-700 mt-2" onclick="deleteKey()">Delete Key</button>
          <p id="deleteKeyResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
        <div>
          <input id="admin_reset_key" class="input" placeholder="Key to reset HWID">
          <button class="btn bg-yellow-500 hover:bg-yellow-600 mt-2" onclick="adminResetKey()">Admin Reset HWID</button>
          <p id="adminResetResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
        <div>
          <input id="reset_email_key" class="input" placeholder="Key to reset email">
          <button class="btn bg-yellow-500 hover:bg-yellow-600 mt-2" onclick="resetEmailFromKey()">Reset Email</button>
          <p id="resetEmailResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
        <div>
          <button class="btn bg-gray-600 hover:bg-gray-700" onclick="downloadDump()">Download Key Dump</button>
          <p id="dumpResult" class="text-sm mt-1 text-gray-400"></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API = "https://key-sys-web.vercel.app/api";
    let ADMIN_PASS = "";

    // üîπ UI Helpers
    const inputStyle = "w-full p-2 bg-[#111318] border border-gray-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500";
    const btnStyle = "px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 transition text-white font-medium";
    document.querySelectorAll("input").forEach(i => i.className = inputStyle);
    document.querySelectorAll("button").forEach(b => { if(!b.classList.contains("tab")) b.className = btnStyle; });

    function showTab(tab) {
      document.querySelectorAll(".tab-panel").forEach(t => t.classList.add("hidden"));
      document.getElementById(tab).classList.remove("hidden");
      document.querySelectorAll("[id^=tab-]").forEach(b => b.classList.remove("tab-active"));
      document.getElementById(`tab-${tab}`).classList.add("tab-active");
    }

    // üîπ API Functions (igual que antes)
    function verifyKey() {
      const key = document.getElementById("v_key").value;
      const hwid = document.getElementById("v_hwid").value;
      fetch(`${API}/verify?key=${key}&hwid=${hwid}`)
        .then(res => res.text())
        .then(data => document.getElementById("verifyResult").textContent = data);
    }

    function resetKey() {
      const key = document.getElementById("r_key").value;
      fetch(`${API}/reset?key=${key}`)
        .then(res => res.text())
        .then(data => document.getElementById("resetResult").textContent = data);
    }

    function bindEmailToKey() {
      const key = document.getElementById("bind_key").value;
      const email = document.getElementById("bind_email").value;
      fetch(`${API}/bindEmail?key=${key}&email=${email}`)
        .then(res => res.text())
        .then(data => document.getElementById("bindEmailResult").textContent = data);
    }

    function authAdmin() {
      const pass = document.getElementById("admin_password").value;
      fetch(`${API}/info?key=dummy&admin=${encodeURIComponent(pass)}`)
        .then(res => res.status === 403 ? null : res.text())
        .then(data => {
          if (data) {
            ADMIN_PASS = pass;
            document.getElementById("admin-auth").classList.add("hidden");
            document.getElementById("admin-actions").classList.remove("hidden");
          } else {
            document.getElementById("adminLoginResult").textContent = "‚ùå Incorrect password";
          }
        });
    }

    function makeKey() {
      fetch(`${API}/make?admin=${ADMIN_PASS}`)
        .then(res => res.text())
        .then(data => document.getElementById("makeKeyResult").textContent = data);
    }

    function checkKeyInfo() {
      const key = document.getElementById("check_key").value;
      fetch(`${API}/info?key=${key}&admin=${ADMIN_PASS}`)
        .then(res => res.json())
        .then(data => document.getElementById("checkKeyInfoResult").textContent = JSON.stringify(data, null, 2))
        .catch(() => document.getElementById("checkKeyInfoResult").textContent = "‚ùå Invalid response");
    }

    function deleteKey() {
      const key = document.getElementById("delete_key").value;
      fetch(`${API}/delete?key=${key}&admin=${ADMIN_PASS}`)
        .then(res => res.text())
        .then(data => document.getElementById("deleteKeyResult").textContent = data);
    }

    function deleteAllKeys() {
      if (!confirm("Are you sure? This will delete ALL keys.")) return;
      fetch(`${API}/deleteAll?admin=${ADMIN_PASS}`)
        .then(res => res.text())
        .then(data => document.getElementById("deleteAllResult").textContent = data);
    }

    function adminResetKey() {
      const key = document.getElementById("admin_reset_key").value;
      fetch(`${API}/adminReset?key=${key}&admin=${ADMIN_PASS}`)
        .then(res => res.text())
        .then(data => document.getElementById("adminResetResult").textContent = data);
    }

    function resetEmailFromKey() {
      const key = document.getElementById("reset_email_key").value;
      fetch(`${API}/resetEmail?key=${key}&admin=${ADMIN_PASS}`)
        .then(res => res.text())
        .then(data => document.getElementById("resetEmailResult").textContent = data);
    }

    function downloadDump() {
      fetch(`${API}/dump?admin=${ADMIN_PASS}`)
        .then(res => res.json())
        .then(data => {
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "keys.json";
          a.click();
          URL.revokeObjectURL(url);
        });
    }
  </script>
</body>
</html>
